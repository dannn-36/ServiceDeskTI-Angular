<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceDesk TI - Vista Agente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../CSS/agent.css">
</head>
<body class="bg-gray-50 h-screen overflow-hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 h-16 flex-shrink-0">
        <div class="h-full px-6 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">IT</span>
                    </div>
                    <h1 class="text-xl font-bold text-gray-900">ServiceDesk TI</h1>
                </div>
                <span class="text-gray-400">|</span>
                <span class="text-sm text-gray-600">Vista Agente</span>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-4 text-sm">
                    <div class="flex items-center space-x-2 px-3 py-1 bg-green-100 text-green-800 rounded-full">
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <span>En línea</span>
                    </div>
                    <div class="flex items-center space-x-2 text-gray-600">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span>👨‍💻</span>
                        </div>
                        <span>Ana López - Agente TI</span>
                    </div>
                </div>
                <button class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                    ⚙️
                </button>
            </div>
        </div>
    </header>

    <div class="flex h-full">
        <!-- Sidebar - Lista de Tickets -->
        <div class="w-80 bg-white border-r border-gray-200 flex flex-col">
            <!-- Stats rápidas -->
            <div class="p-4 bg-gray-50 border-b border-gray-200">
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="bg-white rounded-lg p-3">
                        <div class="text-lg font-bold text-blue-600" id="openTickets">8</div>
                        <div class="text-xs text-gray-500">Abiertos</div>
                    </div>
                    <div class="bg-white rounded-lg p-3">
                        <div class="text-lg font-bold text-yellow-600" id="inProgressTickets">5</div>
                        <div class="text-xs text-gray-500">En Progreso</div>
                    </div>
                    <div class="bg-white rounded-lg p-3">
                        <div class="text-lg font-bold text-red-600" id="urgentTickets">2</div>
                        <div class="text-xs text-gray-500">Urgentes</div>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="p-4 border-b border-gray-200">
                <div class="relative mb-3">
                    <input type="text" placeholder="Buscar tickets..." class="w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" id="searchTickets" onkeyup="filterTickets()">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-gray-400 text-sm">🔍</span>
                    </div>
                </div>
                <div class="flex space-x-2 mb-2">
                    <select class="flex-1 text-sm border border-gray-300 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-blue-500" id="statusFilter" onchange="filterTickets()">
                        <option value="">Todos</option>
                        <option value="abierto">Abiertos</option>
                        <option value="en-progreso">En Progreso</option>
                        <option value="pendiente-usuario">Pendiente Usuario</option>
                        <option value="resuelto">Resueltos</option>
                    </select>
                    <select class="flex-1 text-sm border border-gray-300 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-blue-500" id="priorityFilter" onchange="filterTickets()">
                        <option value="">Prioridad</option>
                        <option value="urgente">Urgente</option>
                        <option value="alta">Alta</option>
                        <option value="media">Media</option>
                        <option value="baja">Baja</option>
                    </select>
                </div>
                <select class="w-full text-sm border border-gray-300 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-blue-500" id="categoryFilter" onchange="filterTickets()">
                    <option value="">Todas las categorías</option>
                    <option value="hardware">🖥️ Hardware</option>
                    <option value="software">💾 Software</option>
                    <option value="network">🌐 Red</option>
                    <option value="email">📧 Email</option>
                    <option value="access">🔐 Accesos</option>
                </select>
            </div>

            <!-- Lista de Tickets -->
            <div class="flex-1 overflow-y-auto" id="ticketsList">
                <!-- Tickets serán cargados por JavaScript -->
            </div>
        </div>

        <!-- Área Principal - Chat y Detalles -->
        <div class="flex-1 flex flex-col">
            <!-- Placeholder cuando no hay ticket seleccionado -->
            <div id="noTicketSelected" class="flex-1 flex items-center justify-center text-gray-500">
                <div class="text-center">
                    <div class="text-6xl mb-4">💬</div>
                    <h3 class="text-lg font-medium mb-2">Selecciona un ticket</h3>
                    <p class="text-sm">Elige un ticket de la lista para comenzar a chatear con el usuario</p>
                </div>
            </div>

            <!-- Vista del ticket seleccionado -->
            <div id="ticketView" class="flex-1 flex flex-col hidden">
                <!-- Header del ticket -->
                <div class="bg-white border-b border-gray-200 p-4">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <span class="text-lg" id="ticketCategoryIcon">🖥️</span>
                                <span class="text-sm font-mono text-gray-500" id="ticketId">TK-001</span>
                                <span id="ticketStatus" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Abierto</span>
                                <span id="ticketPriority" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">Alta</span>
                                <div id="userOnlineStatus" class="flex items-center space-x-1 text-xs text-gray-500">
                                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                    <span>Usuario en línea</span>
                                </div>
                            </div>
                            <h2 class="text-lg font-semibold text-gray-900 mb-1" id="ticketTitle">Título del ticket</h2>
                            <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <span id="ticketUser">👤 Usuario</span>
                                <span id="ticketDepartment">🏢 Departamento</span>
                                <span id="ticketLocation">📍 Ubicación</span>
                                <span id="ticketDate">📅 Fecha</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <select class="text-sm border border-gray-300 rounded-lg px-3 py-1.5 focus:ring-2 focus:ring-blue-500" id="ticketStatusSelect" onchange="updateTicketStatus()">
                                <option value="abierto">🔵 Abierto</option>
                                <option value="en-progreso">🟡 En Progreso</option>
                                <option value="pendiente-usuario">🟣 Pendiente Usuario</option>
                                <option value="resuelto">✅ Resuelto</option>
                                <option value="cerrado">⚫ Cerrado</option>
                            </select>
                            <button class="p-2 text-gray-400 hover:text-gray-600 transition-colors" onclick="showTicketInfo()" title="Información del ticket">
                                ℹ️
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Área de Chat -->
                <div class="flex-1 flex flex-col">
                    <!-- Mensajes -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatMessages">
                        <!-- Mensajes serán cargados por JavaScript -->
                    </div>

                    <!-- Indicador de escritura -->
                    <div id="typingIndicator" class="hidden px-4 py-2 text-sm text-gray-500">
                        <div class="flex items-center space-x-2">
                            <div class="typing-indicator">💬</div>
                            <span>El usuario está escribiendo...</span>
                        </div>
                    </div>

                    <!-- Respuestas rápidas -->
                    <div class="border-t border-gray-200 p-3 bg-gray-50">
                        <div class="flex flex-wrap gap-2 mb-3">
                            <button class="px-3 py-1 bg-blue-100 text-blue-800 text-xs rounded-full hover:bg-blue-200 transition-colors" onclick="insertQuickResponse('saludo')">
                                👋 Saludo
                            </button>
                            <button class="px-3 py-1 bg-green-100 text-green-800 text-xs rounded-full hover:bg-green-200 transition-colors" onclick="insertQuickResponse('solucion')">
                                ✅ Solución
                            </button>
                            <button class="px-3 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full hover:bg-yellow-200 transition-colors" onclick="insertQuickResponse('informacion')">
                                ℹ️ Más info
                            </button>
                            <button class="px-3 py-1 bg-purple-100 text-purple-800 text-xs rounded-full hover:bg-purple-200 transition-colors" onclick="insertQuickResponse('reiniciar')">
                                🔄 Reiniciar
                            </button>
                            <button class="px-3 py-1 bg-red-100 text-red-800 text-xs rounded-full hover:bg-red-200 transition-colors" onclick="insertQuickResponse('escalacion')">
                                ⬆️ Escalar
                            </button>
                            <button class="px-3 py-1 bg-gray-100 text-gray-800 text-xs rounded-full hover:bg-gray-200 transition-colors" onclick="insertQuickResponse('despedida')">
                                👋 Despedida
                            </button>
                        </div>
                    </div>

                    <!-- Input de chat -->
                    <div class="border-t border-gray-200 p-4 bg-white">
                        <div class="flex space-x-3">
                            <div class="flex-1">
                                <textarea class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" id="chatInput" rows="2" placeholder="Escribe tu respuesta..." onkeypress="handleChatKeyPress(event)" oninput="handleTyping()"></textarea>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors font-medium" onclick="sendMessage()">
                                    📤 Enviar
                                </button>
                                <button class="text-gray-500 hover:text-gray-700 text-xs transition-colors" onclick="attachFile()" title="Adjuntar archivo">
                                    📎
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                            <span>Presiona Ctrl+Enter para enviar</span>
                            <span id="charCount">0/500</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de información del ticket -->
    <div id="ticketInfoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full fade-in">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-900">Información del Ticket</h3>
                    <button onclick="closeTicketInfoModal()" class="text-gray-400 hover:text-gray-600">✕</button>
                </div>
                <div class="p-6" id="ticketInfoContent">
                    <!-- Contenido será cargado por JavaScript -->
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                    <button class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors" onclick="closeTicketInfoModal()">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="../JS/agent.js"></script>
</body>
</html>
